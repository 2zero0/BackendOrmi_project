<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fridge Rescuer</title>

  <!-- js -->
  <script defer src="js/index.js" type="module"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- css -->
  <link rel="stylesheet" href="css/style.css" />

  <style>
    .chatlog-table {
      background-color: white;
      font-family: "NeoDunggeunmo";
    }
    th {
      padding: 10px;
      border-right: 1px solid black;
    }
    th:last-child {
      border-right: none;
    }
    
    td {
      padding: 20px;
      border-right: 1px solid black;
      text-align: center;
    }
    td:last-child {
      border-right: none;
    }

    tr {
      border-bottom: 1px solid black;
    }
    tbody>tr:last-child {
      border-bottom: none;
    }

    .table-content {
      border: 4px solid black;
      border-radius: 20px;
      padding: 10px 30px;
      background-color: white;
      margin-top: 30px;
    }

    .guide06 {
      background-color: #58aa8a;
      color: white;
      width: 500px;
      text-align: center;
      border-radius: 20px;
      padding-top: 10px;
      padding-bottom: 10px;
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      font-family: "NeoDunggeunmo";
      font-size: large;
    }
    .highlight {
      background-color: #ffedb0;
      font-weight: bold;
      padding: 3px 10px;
      border-radius: 3px;
    }
    a {
      text-decoration: 3px underline !important;
      text-decoration-color: #58aa8a !important;
      text-underline-offset: 5px;
    }
  </style>
</head>
<body>
  <!-- header -->
  <header class="header">
    <div>
      <img
        class="logo-img"
        src="img/logo.png"
        alt="fridge rescuer 로고 이미지"
      />
    </div>
  </header>
  <!-- //header -->

  <!-- main -->
  <div class="container">
    <div class="guide06">
      <p>당신의 채팅 내역입니다</p>
      <p>상세내용을 보시려면 제목을 클릭 해주세요!</p>
    </div>

    <!-- <div id="chatlog-container"></div> -->
    <div class="table-content">
      <table class="chatlog-table">
        <thead>
            <tr>
              <th><span class="highlight">질문 재료</span></th>
              <th><span class="highlight">채팅 시간</span></th>
            </tr>
        </thead>
        <tbody id="chatlog-container">
        </tbody>
      </table>
    </div>
  </div>
  <!-- //main -->

  <!-- footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-section">
        <span>Young | 2zero0@gmail.com</span>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2023 Ormi - Young. All rights reserved.</p>
    </div>
  </footer>
  <!-- //footer -->

  <script>
    // 로컬 스토리지에서 채팅 내역 불러오기
    const chatLogs = JSON.parse(localStorage.getItem("chatLogs"));

    console.log(chatLogs);

    // 채팅 내역을 화면에 출력
    const chatlogContainer = document.getElementById("chatlog-container");
    chatLogs.forEach(log => {
      // const logDetail = document.createElement("p");
      // logDetail.innerHTML = `질문: ${log.prompt}, 시간: ${log.timestamp}`;
      // chatlogContainer.appendChild(logDetail);

      const logRow = document.createElement("tr");

      const logQuestion = document.createElement("td");
      // logQuestion.innerHTML = log.prompt;
      logQuestion.innerHTML = `<a href="user_chatlog_detail.html?logId=${log.id}">${log.prompt}</a>`;
      logRow.appendChild(logQuestion);

      const logTimestamp = document.createElement("td");
      const formattedTimestamp = formatDate(log.timestamp);
      logTimestamp.innerHTML = formattedTimestamp;
      logRow.appendChild(logTimestamp);

      chatlogContainer.appendChild(logRow);
    });

    function formatDate(timestamp) {
      const date = new Date(timestamp);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, "0");
      const day = String(date.getDate()).padStart(2, "0");
      const hours = String(date.getHours()).padStart(2, "0");
      const minutes = String(date.getMinutes()).padStart(2, "0");

      return `${year}-${month}-${day} ${hours}:${minutes}`;
    }
  </script>
</body>
</html>