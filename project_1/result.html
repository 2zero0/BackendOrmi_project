<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê²°ê³¼-ìš”ë¦¬ëª©ë¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css" />
    <style>
      .modal {
        position: absolute;
        top: 0;
        left: 0;

        width: 100%;
        height: 100%;

        display: none;

        background-color: rgba(0, 0, 0, 0.4);
      }

      .modal.show {
        display: block;
      }

      .modal_body {
        position: absolute;
        top: 50%;
        left: 50%;

        width: 750px;
        /* height: 500px; */
        max-height: 90vh;

        padding: 40px;

        background-color: rgb(255, 255, 255);
        border-radius: 20px;
        box-shadow: 0 2px 3px 0 rgba(34, 36, 38, 0.15);

        transform: translateX(-50%) translateY(-50%);

        overflow: auto;
      }

      .modal_body::-webkit-scrollbar {
        width: 15px;
      }

      .modal_body::-webkit-scrollbar-thumb {
        background-color: #a5cdff;
        border-radius: 10px;
        background-clip: padding-box;
        border: 2px solid transparent;
        box-shadow: inset 0px 0px 5px white;
      }
      .modal_body::-webkit-scrollbar-track {
        background-color: #7b7b7c;
        border-radius: 10px;
        box-shadow: inset 0px 0px 5px white;
      }

      .guide4 {
        font-family: "NeoDunggeunmo";
        font-size: large;
        border-radius: 10px;
        width: 300px;
        padding: 7px;
        text-align: center;
        background-color: #a5cdff;
        color: white;
      }

      .closeButton {
        border: none;
        background-color: white;
        float: right;
      }

      .inputBox {
        display: flex;
      }

      .modal_main {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-left: 35px;
      }

      .searchButton {
        background-color: white;
        border: none;
      }

      .inputBox {
        margin: 20px 10px 20px 22px;
        display: flex;
      }
      .inputStyle {
        width: 240px;
        border: 3px solid #7b7b7c;
        border-radius: 5px;
        font-family: "NeoDunggeunmo";
        padding: 5px;
      }

      .imgBox {
        width: 400px;
        height: 400px;
        /* border: 3px solid #7b7b7c; */
        border-radius: 5px;
        display: flex;
        flex-wrap: wrap;
        padding-left: 2px;
      }

      .recipeBox {
        border-radius: 10px;
        margin: 30px 20px 0 20px;
        padding: 10px;
        width: 500px;
        font-family: "NeoDunggeunmo";
        font-size: medium;
        line-height: 25px;
        background-color: #a5cdff;
        color: black;
      }

      .highlight2 {
        display: inline;
        box-shadow: inset 0 -15px 0 white;
        /*-10pxì€ highlightì˜ ë‘ê»˜*/
        color: #394049;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!--modal-->
      <div class="modal">
        <div class="modal_body">
          <button class="closeButton">
            <img
              src="img/free-icon-cancel-8532370.png"
              style="width: 30px; height: 30px"
            />
          </button>

          <div class="modal_main">
            <div class="guide4">
              <p>ë ˆì‹œí”¼ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”</p>
            </div>
            <div class="inputBox">
              <input
                type="text"
                class="inputStyle"
                placeholder="ex, ê°ìì „"
                id="search-input"
              />
              <button
                onclick="searchImages(); searchRecipe();"
                class="searchButton"
              >
                <img
                  src="img/search.png"
                  alt=""
                  style="width: 30px; height: 30px; margin-left: 10px"
                />
              </button>
            </div>
            <div class="imgBox">
              <!-- <img
                id="recipeImg"
                src="img/pizza.jpg"
                alt="ì˜ì“°"
                style="width: 400px; height: 400px"
              /> -->
            </div>
            <div class="recipeBox">
              <p style="text-align: center">
                ì ì‹œë§Œ ê¸°ë‹¤ë¦¬ì‹œë©´ ì´ ê³³ì— ë ˆì‹œí”¼ê°€ ì¶œë ¥ë©ë‹ˆë‹¤!
              </p>
            </div>
          </div>
        </div>
      </div>
      <!--main-->
      <div style="display: flex">
        <div class="cookingIcon">
          <img class="chefIcon2" src="img/free-icon-chef-7414124.png" />
          <!--ë‹¤ì–‘í•œ ì•„ì´ì½˜ ë„£ê¸°-->
        </div>
        <div class="chefAnswer">
          <div class="cookingList">
            <div id="resultAnswer"></div>
          </div>
          <div class="guide3">
            <p>ëŒì•„ê°€ì‹œë ¤ë©´ ë‹¹ê·¼ì„, ë ˆì‹œí”¼ë¥¼ ë³´ì‹œë ¤ë©´ ë ˆì‹œí”¼ë¶ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!</p>
          </div>
          <div class="buttonBox">
            <!--ë²„íŠ¼1(ëŒì•„ê°€ê¸°)-->
            <div class="buttonImg2">
              <img src="img/free-icon-carrot-1514935.png" alt="" />
            </div>
            <!--ë²„íŠ¼2(ë ˆì‹œí”¼ë³´ê¸°)-->
            <button class="btn-open-popup">
              <img class="buttonImg3" src="img/rc3.png" alt="" />
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- <script src="js/script.js"></script> -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê°’ì„ ê°€ì ¸ì™€ì„œ ì¶œë ¥
        // ì…ë ¥ê°’
        const inputValue = localStorage.getItem("inputValue");
        console.log(inputValue);

        // ì¶œë ¥ê°’
        const resultValue = localStorage.getItem("resultValue");
        console.log(resultValue);

        // document.querySelector("#contents3").innerText = resultValue;

        // í•˜ì´ë¼ì´íŒ… íš¨ê³¼ + ìš”ë¦¬ëª©ë¡ ì¶œë ¥
        const lines = resultValue.split("\n");
        let formattedString = "";

        lines.forEach((line) => {
          // console.log(line);
          const trimmedLine = line.trim();
          // console.log(trimmedLine);
          if (trimmedLine !== "") {
            // console.log(trimmedLine);
            const dotIndex = trimmedLine.indexOf(":");
            // console.log(dotIndex);
            if (dotIndex !== -1) {
              const number = trimmedLine.substring(0, dotIndex).trim();
              // console.log(number);
              const dish = trimmedLine.substring(dotIndex + 1).trim();
              // console.log(dish);
              const formattedLine = `<b class="highlight">${number}:</b> ${dish}`;
              formattedString += `${formattedLine}<br>`;
            } else {
              formattedString += `<br>${trimmedLine}<br><br>`;
            }
          }
        });

        const pElement = document.createElement("p");
        pElement.innerHTML = formattedString;
        // document.body.appendChild(pElement);
        document.getElementById("resultAnswer").appendChild(pElement);
      });

      // ë‹¹ê·¼ í´ë¦­ì‹œ í˜ì´ì§€ ì´ë™
      document.querySelector(".buttonImg2").addEventListener("click", (e) => {
        window.location = "index.html";
      });

      /*ëª¨ë‹¬*/
      // xí´ë¦­ ì‹œ ëª¨ë‹¬ ì œê±°
      const xImg = document.querySelector(".closeButton");
      xImg.addEventListener("click", () => {
        modal.classList.remove("show");
        body.style.overflow = "auto";
      });

      // ëª¨ë‹¬ ì»¨íŠ¸ë¡¤
      const body = document.querySelector("body");
      const modal = document.querySelector(".modal");
      const btnOpenPopup = document.querySelector(".btn-open-popup");

      // ëª¨ë‹¬ ë“±ì¥
      btnOpenPopup.addEventListener("click", () => {
        window.scrollTo(0, 0);
        modal.classList.toggle("show");

        if (modal.classList.contains("show")) {
          body.style.overflow = "hidden";
        }
      });

      // ëª¨ë‹¬ê³¼ body ìŠ¤í¬ë¡¤ ì œì–´
      modal.addEventListener("click", (event) => {
        if (event.target === modal) {
          modal.classList.toggle("show");

          if (!modal.classList.contains("show")) {
            body.style.overflow = "auto";
          }
        }
      });

      // ëª¨ë‹¬ - ì´ë¯¸ì§€ ì¶œë ¥ (ì¹´ì¹´ì˜¤ API)
      function searchImages() {
        const query = document.getElementById("search-input").value;
        // document.getElementById("inputTxt").innerText = query + "ğŸ’–";

        if (!query) {
          alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
          return;
        }

        const imgBox = document.querySelector(".imgBox");
        imgBox.innerHTML = ""; // ì´ì „ì˜ ì¶œë ¥ ê°’ì„ ì´ˆê¸°í™”

        fetch(`https://dapi.kakao.com/v2/search/image?query=${query}`, {
          method: "GET",
          headers: {
            Authorization: "KakaoAK 9cafd6a49ad0561ac99a151b58f2d4b4",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            // ì¶œë ¥ í™•ì¸ìš©
            // console.log(data);
            // console.log(data.documents[0].thumbnail_url);

            for (let i = 0; i < 9; i++) {
              const imageElement = document.createElement("img");
              imageElement.src = data.documents[i].thumbnail_url;
              imageElement.style.width = "130px";
              imageElement.style.height = "130px";
              imgBox.appendChild(imageElement);
            }
          })
          .catch((error) => {
            console.error(error);
          });
      }

      // ëª¨ë‹¬ - ë ˆì‹œí”¼ ì¶œë ¥ (chatGPT API)
      // ê²€ìƒ‰(ë‹ë³´ê¸°) ë²„íŠ¼ í´ë¦­ ì‹œ searchImages() í•¨ìˆ˜ì™€ ë™ì‹œ í˜¸ì¶œ

      let url = `https://estsoft-openai-api.jejucodingcamp.workers.dev/`;

      let data = [
        {
          role: "system",
          content:
            "assistantëŠ” ìš”ë¦¬ ì „ë¬¸ê°€ì´ë‹¤. ì‚¬ìš©ìê°€ ë§Œë“¤ê³  ì‹¶ì€ ìš”ë¦¬ ì´ë¦„ì„ ì…ë ¥í•˜ë©´ ì¬ë£Œì™€ ì¡°ë¦¬ì ˆì°¨ì˜ í˜•ì‹ìœ¼ë¡œ ë ˆì‹œí”¼ë¥¼ ì•Œë ¤ì¤€ë‹¤.",
        },
        {
          role: "user",
          content: "ê°ìì „",
        },
        {
          role: "assistant",
          content:
            "-ì¬ë£Œ: ê°ì 2ê°œ, ì†Œê¸ˆ ì•½ê°„, ì‹ìš©ìœ  \n\n-ì¡°ë¦¬ ì ˆì°¨: \n1. ê°ìë¥¼ ê¹¨ë—ì´ ì”»ì€ í›„ ê»ì§ˆì„ ë²—ê¸°ê³ , ì–‡ê²Œ ì±„ ì°ì–´ì£¼ì„¸ìš”.\n2. ì°ì€ ê°ìì— ì•½ê°„ì˜ ì†Œê¸ˆì„ ë¿Œë¦¬ê³  ì˜ ë²„ë¬´ë ¤ ì£¼ì„¸ìš”. ì†Œê¸ˆì´ ê°ìì— ê³ ë£¨ ë¬»ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤. \n3. íŒ¬ì— ì‹ìš©ìœ ë¥¼ ë‘ë¥´ê³  ì¤‘ê°„ ë¶ˆì—ì„œ ë‹¬êµ° í›„, ê°ìë¥¼ í•œ ì¤Œì”© ì§‘ì–´ë„£ì–´ ë™ê¸€ë™ê¸€í•˜ê²Œ ëª¨ì–‘ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”. \n4. ê°ìì „ì„ ë…¸ë¦‡í•˜ê²Œ êµ½ê³  ë’¤ì§‘ì–´ì„œ ì–‘ë©´ì´ ê³ ë£¨ ìµë„ë¡ í•´ì£¼ì„¸ìš”. ì•½ 2~3ë¶„ì”© êµ½ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. \n5. ê°ìì „ì´ ê³¨ê³ ë£¨ ìµìœ¼ë©´ ì ‘ì‹œì— ë‹´ì•„ì„œ ê³ë“¤ì¼ ì–‘ë…ê³¼ í•¨ê»˜ ë‚´ë†“ìœ¼ë©´ ì™„ì„±ì…ë‹ˆë‹¤.",
        },
      ];

      function searchRecipe() {
        const inputRecipeName = document.getElementById("search-input").value;
        // ì¶œë ¥í™•ì¸ìš©
        console.log("ì…ë ¥ê°’: ", inputRecipeName);

        // ì´ˆê¸°í™” + ì…ë ¥ ê°’ ì¶œë ¥
        document.querySelector(
          ".recipeBox"
        ).innerHTML = `<p style='text-align: center'>ì ì‹œë§Œ ê¸°ë‹¤ë¦¬ì‹œë©´ ì´ ê³³ì— <b style='color: #394049'>'${inputRecipeName}'</b> ë ˆì‹œí”¼ê°€ ì¶œë ¥ë©ë‹ˆë‹¤!</p>`;

        data.push({
          role: "user",
          content: inputRecipeName,
        });

        chatGptAPI();
      }

      function chatGptAPI() {
        fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
          redirect: "follow",
        })
          .then((res) => res.json())
          .then((res) => {
            console.log("res: ", res); // ì¶œë ¥test
            console.log("ì¶œë ¥ê°’: ", res.choices[0].message.content); // ì¶œë ¥test

            const resultRecipe = res.choices[0].message.content;
            // í•˜ì´ë¼ì´íŒ… ì‹œì‘
            const line_group = resultRecipe.split("\n");
            let formattedStr = "";

            line_group.forEach((line, index) => {
              const trim_line = line.trim();
              if (trim_line !== "") {
                const dotIdx = trim_line.indexOf(":");
                if (dotIdx !== -1) {
                  const title = trim_line.substring(0, dotIdx).trim();
                  const description = trim_line.substring(dotIdx + 1).trim();
                  const format_line = `<br><b class="highlight2">${title}:</b> ${description}`;
                  formattedStr += `${format_line}<br>`;
                } else {
                  formattedStr += `${trim_line}<br>`;
                }
              }

              // ë§ˆì§€ë§‰ ì¤„ì— <br> ì‚½ì…
              if (index === line_group.length - 1) {
                formattedStr += "<br>";
              }
            });
            document.querySelector(".recipeBox").innerHTML = formattedStr;
          })
          .catch((error) => {
            console.error(error);
          });
      }
    </script>
  </body>
</html>
